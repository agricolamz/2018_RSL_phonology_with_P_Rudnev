---
title: "Tosha's data"
author: "G. Moroz"
output: 
  html_document:
    df_print: paged
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warnings = FALSE, fig.width = 12, fig.height = 7)
library(tidyverse)
theme_set(theme_bw())
```

У нас есть Тошина разметка, что мы можем сказать интересного на ее основании? Там есть следующие названия столбцов:

```{r}
df <- read_csv("Tosha_annotation.csv", na = "")
colnames(df)
```

Я хочу найти аутлайеров как среди точек, так и среди наблюдаемых значений. Построю MCA:

```{r}
MCA <- MASS::mca(read.csv("Tosha_annotation.csv", na.strings = "")[,-c(1, 22, 23)])
df <- cbind(df, MCA$rs)
variables <- as_data_frame(MCA$cs)
variables$var_names <- rownames(MCA$cs)
```

Вот точки: <br>


##  {.tabset .tabset-fade .tabset-pills}

### Meaning
```{r}
df %>% 
  ggplot(aes(`1`, `2`, label = Sign))+
  geom_text()
```

### H1.FingerSelection
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H1 FingerSelection`))+
  geom_point()+
  stat_ellipse()
```

### H1.Aperture
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H1 Aperture`))+
  geom_point()+
  stat_ellipse()
```

### H1.Curve
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H1 Curve`))+
  geom_point()+
  stat_ellipse()
```

### H1.Bent
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H1 Bent`))+
  geom_point()+
  stat_ellipse()
```

### H1.Facing
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H1 Facing`))+
  geom_point()+
  stat_ellipse()
```

### H1.Focus
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H1 Focus`))+
  geom_point()+
  stat_ellipse()
```

### H1.Width
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H1 Width`))+
  geom_point()+
  stat_ellipse()
```

### Dynamic.Orientation
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `Dynamic Orientation`))+
  geom_point()+
  stat_ellipse()
```

### Location
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = Location))+
  geom_point()+
  stat_ellipse()
```

### Plane
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = Plane))+
  geom_point()+
  stat_ellipse()
```

### Settings
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = Settings))+
  geom_point()+
  stat_ellipse()
```

### Path
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = Path))+
  geom_point()+
  stat_ellipse()
```

### H2.FingerSelection
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H2 FingerSelection`))+
  geom_point()+
  stat_ellipse()
```

### H2.Aperture
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H2 Aperture`))+
  geom_point()+
  stat_ellipse()
```

### H2.Curve
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H2 Curve`))+
  geom_point()+
  stat_ellipse()
```

### H2.Bent
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H2 Bent`))+
  geom_point()+
  stat_ellipse()
```

### H2.Width
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H2 Width`))+
  geom_point()+
  stat_ellipse()
```

### H2.Facing
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H2 Facing`))+
  geom_point()+
  stat_ellipse()
```

### H2.Focus
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = `H2 Focus`))+
  geom_point()+
  stat_ellipse()
```

### Manner
```{r}
df %>% 
  ggplot(aes(`1`, `2`, color = Manner))+
  geom_point()+
  stat_ellipse()
```

## 

Что это за аутлайеры? <br>

```{r}
df %>% 
  arrange(desc(`1`)) %>% 
  select(labeled_url, `1`,`2`) %>% 
  DT::datatable(escape = FALSE, options = list(pageLength = 10, dom = 'ftip'))
```

Вот переменные: <br>

```{r}
variables %>% 
  ggplot(aes(`1`, `2`, label = var_names))+
  geom_text()+
  scale_x_continuous(limits = c(-0.03, 0.06))
```

Чего-то слева торчат переменные, относящиеся к правой руке. Интересно. Может быть это какие-то двуручные? Тогда чего их так мало... Надо будет разобраться.

А вот все вместе: <br>

```{r}
df %>% 
  ggplot(aes(`1`, `2`))+
  geom_text(data = variables, aes(`1`, `2`, label = var_names))+
  geom_point(color = "red")+
  scale_x_continuous(limits = c(-0.03, 0.06))
```

## Тошина модель

![](RSL-phonology-plaskovitskaya-2018-model.jpg)

Насколько важны все узлы?

```{r}
data_frame(value = colMeans(!is.na(df[,-c(1, 22:25)])),
           features = names(colMeans(!is.na(df[,-c(1, 22:25)])))) %>% 
  mutate(features = reorder(features, value)) %>% 
  ggplot(aes(features, value, label = round(value, 3)))+
  ggrepel::geom_text_repel()+
  geom_point()+
  coord_flip()+
  labs(x="", y = "ratio in the whole dataset")
```

